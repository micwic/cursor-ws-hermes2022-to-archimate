---
description: Gouvernance des tests de contraintes architecturales
alwaysApply: true
---

# architectural-constraints-testing.mdc : Gouvernance des tests de contraintes architecturales

> Cr√©√© le : 2025-11-09
> Derni√®re mise √† jour : 2025-11-09

## Objectifs de la r√®gle

- Garantir que les contraintes architecturales explicites sont valid√©es automatiquement
- Pr√©venir les d√©rives architecturales non d√©tect√©es
- Assurer la coh√©rence entre sp√©cifications et impl√©mentation
- D√©tecter pr√©cocement les violations de contraintes

## Probl√®mes r√©solus/√† r√©soudre

- D√©rive architecturale non d√©tect√©e (ex: JArchi ‚Üí Node.js)
- Introduction progressive de d√©pendances incompatibles
- Absence de validation automatique des contraintes non-fonctionnelles
- D√©couverte tardive des incompatibilit√©s architecturales

## Comportement g√©n√©ral attendu

- L'IA cr√©e syst√©matiquement des tests de conformit√© architecturale pour tout projet avec contraintes explicites
- L'utilisateur valide que les tests couvrent toutes les contraintes architecturales
- Les tests architecturaux sont ex√©cut√©s √† chaque g√©n√©ration/modification de code
- Toute violation de contrainte d√©clenche une alerte imm√©diate

## Contexte d'application et g√©n√©ralit√©s

- S'applique √† tous les projets avec contraintes architecturales explicites
- Compl√®te les tests fonctionnels (BDD, unitaires, int√©gration)
- Les contraintes architecturales incluent : compatibilit√© runtime, d√©pendances autoris√©es, patterns obligatoires, limitations techniques

## R√®gles √† appliquer

### Identification des contraintes architecturales

#### R√®gles obligatoires √† appliquer

- **IDENTIFIER CONTRAINTES** : Lister toutes les contraintes architecturales explicites dans les sp√©cifications
- **DOCUMENTER CONTRAINTES** : Chaque contrainte doit √™tre document√©e avec sa justification
- **CAT√âGORISER CONTRAINTES** : Classer par type (runtime, d√©pendances, patterns, limitations)

#### Types de contraintes architecturales

- **Runtime** : Environnement d'ex√©cution requis (JArchi, Node.js, Browser, Serverless, Edge)
- **D√©pendances** : Packages autoris√©s/interdits, versions requises
- **Patterns** : Architectures obligatoires (SOLID, DDD, Microservices)
- **Limitations** : Taille m√©moire, timeout, bande passante, API disponibles

### Cr√©ation des tests de conformit√©

#### R√®gles obligatoires √† appliquer

- **TESTS AUTOMATIS√âS** : Cr√©er des tests automatis√©s pour chaque contrainte
- **EX√âCUTION SYST√âMATIQUE** : Int√©grer dans la suite de tests principale
- **FEEDBACK IMM√âDIAT** : Messages d'erreur clairs indiquant la contrainte viol√©e
- **LOCALISATION** : Tests dans `__tests__/architectural-constraints/`

#### Patterns valid√©s pour les tests de conformit√©

**Test de compatibilit√© JArchi** :

```javascript
// __tests__/architectural-constraints/jarchi-compatibility.test.js
const fs = require('fs');
const path = require('path');

describe('Compatibilit√© JArchi', () => {
  const jarchiFiles = [
    'src/jarchi-loader.js',
    'src/jarchi-utils.js'
  ];

  test.each(jarchiFiles)('Aucune d√©pendance Node.js dans %s', (filePath) => {
    const code = fs.readFileSync(filePath, 'utf8');
    
    // V√©rifier absence de require() Node.js
    expect(code).not.toMatch(/require\(['"]fs['"]\)/);
    expect(code).not.toMatch(/require\(['"]https?['"]\)/);
    expect(code).not.toMatch(/require\(['"]path['"]\)/);
    expect(code).not.toMatch(/require\(['"]find-up['"]\)/);
    
    // V√©rifier absence de packages npm
    expect(code).not.toMatch(/require\(['"]ajv['"]\)/);
    expect(code).not.toMatch(/require\(['"]jsonwebtoken['"]\)/);
    expect(code).not.toMatch(/require\(['"]html-to-text['"]\)/);
  });

  test.each(jarchiFiles)('Utilisation API Java dans %s', (filePath) => {
    const code = fs.readFileSync(filePath, 'utf8');
    
    // V√©rifier pr√©sence d'API Java pour I/O
    if (code.includes('HTTP') || code.includes('http')) {
      expect(code).toMatch(/Java\.type\(['"]java\.net\.http/);
    }
    
    if (code.includes('file') || code.includes('File')) {
      expect(code).toMatch(/Java\.type\(['"]java\.nio\.file/);
    }
  });
});
```

**Test de d√©pendances autoris√©es** :

```javascript
// __tests__/architectural-constraints/dependencies.test.js
const packageJson = require('../../package.json');

describe('D√©pendances autoris√©es', () => {
  const allowedDependencies = [
    'ajv',
    'ajv-formats',
    'jsonwebtoken',
    'html-to-text',
    'find-up',
    '@apidevtools/json-schema-ref-parser'
  ];

  test('Uniquement d√©pendances autoris√©es dans devDependencies', () => {
    const deps = Object.keys(packageJson.devDependencies || {});
    const testDeps = deps.filter(d => !d.startsWith('jest') && !d.startsWith('@babel'));
    
    testDeps.forEach(dep => {
      expect(allowedDependencies).toContain(dep);
    });
  });

  test('Aucune d√©pendance en production', () => {
    expect(packageJson.dependencies).toBeUndefined();
  });
});
```

**Test de patterns architecturaux** :

```javascript
// __tests__/architectural-constraints/solid-patterns.test.js
const fs = require('fs');

describe('Patterns SOLID', () => {
  test('Module API ne contient pas de logique m√©tier', () => {
    const apiCode = fs.readFileSync('src/nuextract-api.js', 'utf8');
    
    // V√©rifier absence de fallbacks (logique m√©tier)
    expect(apiCode).not.toMatch(/\|\|.*['"]default/);
    expect(apiCode).not.toMatch(/config\?\.nuextract/);
  });

  test('Module client utilise Dependency Injection', () => {
    const clientCode = fs.readFileSync('src/nuextract-client.js', 'utf8');
    
    // V√©rifier absence de variables globales
    expect(clientCode).not.toMatch(/^const GLOBAL_/m);
    expect(clientCode).not.toMatch(/^let GLOBAL_/m);
  });
});
```

#### Anti-Patterns pour les tests de conformit√© √† √©viter

- **Tests manuels** : √âviter de valider les contraintes manuellement ‚Üí **Solution** : Tests automatis√©s ‚Üí **R√®gle √† adopter** : Automatisation obligatoire
- **Tests incomplets** : √âviter de ne tester qu'une partie des contraintes ‚Üí **Solution** : Couverture exhaustive ‚Üí **R√®gle √† adopter** : Une contrainte = un test
- **Messages vagues** : √âviter "Test failed" ‚Üí **Solution** : Message explicite avec contrainte viol√©e ‚Üí **R√®gle √† adopter** : Feedback clair

### Int√©gration dans le workflow

#### R√®gles obligatoires √† appliquer

- **CI/CD** : Ex√©cuter les tests architecturaux dans la pipeline CI/CD
- **PRE-COMMIT** : Optionnel mais recommand√© pour feedback imm√©diat
- **DOCUMENTATION** : Documenter les contraintes dans les sp√©cifications
- **MAINTENANCE** : Mettre √† jour les tests lors de changements de contraintes

#### Patterns valid√©s pour l'int√©gration

**Script npm** :

```json
{
  "scripts": {
    "test": "jest",
    "test:arch": "jest --testPathPattern=architectural-constraints",
    "test:all": "npm run test:arch && npm test"
  }
}
```

**Configuration Jest** :

```javascript
// jest.config.js
module.exports = {
  testMatch: [
    '**/__tests__/**/*.test.{js,ts}',
    '**/__tests__/architectural-constraints/**/*.test.{js,ts}'
  ]
};
```

### Validation et maintenance

#### R√®gles obligatoires √† appliquer

- **REVUE R√âGULI√àRE** : V√©rifier que les tests couvrent toutes les contraintes
- **MISE √Ä JOUR** : Adapter les tests lors de changements architecturaux
- **DOCUMENTATION** : Maintenir la coh√©rence sp√©cifications ‚Üî tests
- **ALERTES** : Configurer des alertes pour violations de contraintes

## Exemples de contraintes architecturales

### ‚úÖ Contraintes bien d√©finies

- **JArchi** : "Le code doit s'ex√©cuter dans JArchi sans d√©pendances Node.js"
- **Serverless** : "Les fonctions Lambda doivent avoir un cold start <1s"
- **Edge Computing** : "Le code doit √™tre <1MB apr√®s minification"
- **Browser** : "Aucune d√©pendance Node.js (fs, path, http)"

### ‚ùå Contraintes mal d√©finies

- **Vague** : "Le code doit √™tre performant" ‚Üí Pas testable automatiquement
- **Implicite** : "Utiliser les bonnes pratiques" ‚Üí Trop g√©n√©rique
- **Ambigu√´** : "√âviter les d√©pendances lourdes" ‚Üí Seuil non d√©fini

## Validation

- V√©rifier que chaque contrainte architecturale a un test automatis√©
- V√©rifier que les tests sont ex√©cut√©s syst√©matiquement
- V√©rifier que les messages d'erreur sont clairs
- V√©rifier la coh√©rence entre sp√©cifications et tests

## √âtat d'impl√©mentation

üöß [R√®gle d√©finie - 2025-11-09]

- ‚úÖ R√®gle document√©e
- ‚ùå √Ä impl√©menter : Tests architecturaux pour hermes2022-concepts-site-extraction
- ‚ùå √Ä impl√©menter : Tests architecturaux pour archimate-model-loader (JArchi)
- ‚ùå √Ä impl√©menter : Int√©gration CI/CD

## R√©f√©rences

- Le√ßons apprises : `.cursor/rules/summary/2025-11-09-lecons-derive-jarchi-nodejs.md`
- Sp√©cification module : `hermes2022-concepts-site-extraction/.cursor/rules/specification-hermes2022-concepts-site-extraction.mdc`
- Sp√©cification projet : `.cursor/rules/specification-hermes2022-to-archimate.mdc`
