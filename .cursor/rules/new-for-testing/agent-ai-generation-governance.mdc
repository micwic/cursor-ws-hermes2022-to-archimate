---
description: "Gouvernance de la génération de contenu par l'IA optimisée pour la fonctionnalité Plan de Cursor"
alwaysApply: true
---

# agent-ai-generation-governance.mdc: Gouvernance de la génération de contenu par l'IA optimisée pour Cursor

> Créé le : 2025-08-18
> Dernière mise à jour : 2025-11-12

## Objectifs de la règle

- Optimiser l'utilisation de la fonctionnalité Plan intégrée de Cursor
- Garantir l'utilisation exclusive de références officielles dans tous les processus
- Éviter les procédés manuels concurrents à la fonctionnalité Plan de Cursor
- Maintenir la cohérence entre spécifications, plans et exécutions
- Assurer que les commentaires dans le code décrivent uniquement le comportement effectif

## Problèmes résolus/à résoudre

- Procédés manuels de planification concurrençant la fonctionnalité Plan native de Cursor
- Utilisation de références non officielles dans l'élaboration des spécifications et plans
- Manque d'intégration avec les mécanismes de validation et traçabilité de Cursor
- Incohérences entre spécifications et exécutions réelles
- Commentaires historiques et notes explicatives polluant le code source

## Comportement général attendu

- L'IA utilise exclusivement la fonctionnalité Plan intégrée de Cursor pour les tâches complexes
- L'IA consulte et valide les spécifications avant d'activer le mode Plan
- L'utilisateur valide les plans via l'interface de Cursor avant exécution
- L'IA sauvegarde automatiquement le plan après exécution (build) dans .cursor/executed-plans à la racine du projet principal concerné (pas du workspace préfixé avec cursor-ws-*)
- La traçabilité est assurée automatiquement par les mécanismes intégrés de Cursor
- Les références officielles sont utilisées à tous les niveaux du processus
- Les commentaires dans le code généré décrivent uniquement le comportement effectif, sans notes historiques

## Contexte d'application et généralités

- S'applique à toute utilisation de la génération de contenu par l'IA via Cursor
- Optimise l'utilisation de la fonctionnalité Plan intégrée de Cursor
- Complète les règles @specification-governance et @cursor-rules-governance
- Élimine les procédés manuels concurrents à la fonctionnalité Plan de Cursor
- Garantit l'utilisation exclusive de références officielles vérifiées

## Règles à appliquer

### Utilisation de la fonctionnalité Plan de Cursor

#### Règles obligatoires à appliquer

- **ACTIVER MODE PLAN** : Utiliser systématiquement la fonctionnalité Plan intégrée de Cursor pour toute génération complexe nécessitant validation
- **INTÉGRER SPÉCIFICATIONS** : S'assurer que les spécifications du projet sont consultées et mises à jour avant d'activer le mode Plan
- **VALIDER CONTEXTE** : Vérifier l'alignement entre l'intention utilisateur et les spécifications avant de générer un plan
- **SAUVEGARDER AUTOMATIQUEMENT** : Après l'exécution complète du plan, l'IA sauvegarde automatiquement le plan dans `.cursor/executed-plans/YYYY-MM-DD-description.md` à la racine du projet principal concerné (pas du workspace préfixé avec cursor-ws-*)
- **FIABILITE REFERENCES** : Il est formellement interdit de baser ses recherches et ses réflexions sur la base de supposition ou de référence peu fiable. Les références officielles doivent être utilisées pour :
  - **Élaborer les spécifications** : Sources documentaires officielles uniquement
  - **Créer les plans d'exécution** : Documentation officielle et spécifications validées
  - **Implémenter les solutions** : Respect strict des plans validés et documentation technique officielle

#### Comportements interdits/proscrits/à éviter

- **PROCÉDÉ MANUEL CONCURRENT** : Ne pas utiliser de procédé manuel de planification qui concurrence la fonctionnalité Plan native de Cursor
- **GÉNÉRATION DIRECTE** : Ne jamais générer sans vérifier les spécifications correspondantes
- **VALIDATION ASSUMÉE** : Ne pas supposer l'accord utilisateur sans demande explicite
- **RÉFÉRENCES NON FIABLES** : Ne pas utiliser de sources non officielles pour l'élaboration des spécifications ou des plans

#### Validation

- Spécifications consultées et alignées avec l'intention utilisateur avant activation du mode Plan
- Fonctionnalité Plan de Cursor utilisée pour les modifications complexes nécessitant validation
- Accord utilisateur explicite obtenu via la fonctionnalité Plan de Cursor
- Plan sauvegardé automatiquement dans `.cursor/executed-plans/` du projet principal après exécution complète
- Traçabilité assurée via fichier de plan et commit Git

#### Exemples d'utilisation de la fonctionnalité Plan de Cursor

##### ✅ Correct — Utilisation du mode Plan de Cursor

Prérequis avant activation du Plan:

- Spécifications pertinentes consultées et mises à jour si nécessaire
- Intention utilisateur clarifiée et validée
- Contexte technique vérifié (références officielles uniquement)

Processus avec fonctionnalité Plan de Cursor :

1. **Activation du mode Plan** : Utiliser la fonctionnalité intégrée de Cursor
2. **Intégration des spécifications** : Le plan généré doit respecter les spécifications validées
3. **Validation utilisateur** : Accord explicite obtenu via l'interface de Cursor
4. **Exécution contrôlée** : Réalisation selon le plan approuvé
5. **Sauvegarde automatique** : L'IA sauvegarde le plan dans `.cursor/executed-plans/YYYY-MM-DD-description.md` du projet principal
6. **Traçabilité Git** : L'IA propose de commiter le plan avec les changements effectués

##### ✅ Correct — Respect des références officielles

Avant génération du plan :

- Consulter uniquement la documentation officielle
- Éviter toute interprétation personnelle, notamment des structures d'API
- Baser les spécifications sur des sources vérifiées

Pendant génération du plan :

- Utiliser les spécifications validées comme base
- Respecter les contraintes techniques documentées officiellement
- Éviter les suppositions sur les fonctionnalités non documentées

##### ❌ Incorrect — Violations des règles

- **Procédé manuel concurrent** : Créer des fichiers de plan personnalisés au lieu d'utiliser la fonctionnalité Plan de Cursor
- **Références non fiables** : Utiliser des suppositions ou de la documentation non officielle
- **Validation implicite** : Procéder sans accord utilisateur explicite via l'interface de Cursor
- **Plan non sauvegardé** : Ne pas sauvegarder le plan après exécution complète → L'IA doit systématiquement créer le fichier dans `.cursor/executed-plans/`

### Commentaires dans le code généré

#### Règles obligatoires pour les commentaires dans le code

- **DÉCRIRE COMPORTEMENT EFFECTIF** : Les commentaires dans le code doivent décrire uniquement ce que le code FAIT actuellement
- **PAS D'HISTORIQUE** : Ne jamais inclure de notes historiques, de justifications de suppressions ou d'explications sur ce que le code ne fait pas
- **PAS DE NOTES "À FAIRE"** : Les notes "Note:", "TODO:", "FIXME:" ne doivent pas être utilisées pour documenter l'historique
- **DOCUMENTATION EXTERNE** : Toute information historique, justification de décisions ou notes explicatives doit être documentée dans :
  - `.cursor/executed-plans/` pour l'historique des changements et décisions de session
  - `.cursor/rules/summary/` pour la capitalisation des leçons apprises
  - Les règles de gouvernance (`@*.mdc`) pour les principes généraux établis

#### Justification

- **Lisibilité du code** : Code plus clair sans pollution de commentaires historiques
- **Maintenance simplifiée** : Un seul endroit pour trouver l'historique (executed-plans, summary)
- **Traçabilité centralisée** : Documentation historique structurée et facilement consultable
- **Focus sur le comportement** : Les développeurs comprennent ce que le code fait, pas ce qu'il faisait

#### Patterns validés

**Commentaire correct (décrit le comportement)** :

```javascript
// Validation : htmlContents ne doit pas être vide
if (block.htmlContents.length === 0) {
  throw new Error('block.htmlContents is empty. No HTML content found for this block. Script stopped.');
}
```

**Commentaire correct (docstring de fonction)** :

```javascript
/**
 * Construit le prompt d'extraction pour un bloc spécifique
 * @param {{jsonPointer: string, instructions: Array<string>, htmlContents: Array<{url: string, content: string}>}} block - Bloc avec JSON Pointer, instructions et contenus HTML
 * @returns {string} - Prompt Markdown pour ce bloc
 */
function buildBlockPrompt(block) {
  // ...
}
```

#### Anti-Patterns à éviter

**Commentaire historique (à ne PAS faire)** :

```javascript
// ❌ MAUVAIS : Note historique
// Note: Pas de validation structure bloc car block est construit localement 
// dans collectHtmlSourcesAndInstructions avec structure garantie
// (voir @code-modularity-governance section "Validations défensives appropriées")
if (block.htmlContents.length === 0) {
  throw new Error('...');
}
```

**Commentaire sur suppression (à ne PAS faire)** :

```javascript
// ❌ MAUVAIS : Explication de ce qui a été supprimé
// Note: La validation "target null" a été supprimée car target est garanti 
// non-null par construction locale
function mergeJsonAtPath(target, path, value) {
  // ...
}
```

**Commentaire TODO historique (à ne PAS faire)** :

```javascript
// ❌ MAUVAIS : Note sur ce qui n'est pas implémenté
// TODO: Ajouter validation supplémentaire (voir issue #123)
// Note: Cette validation a été retirée le 2025-11-12
function processData(data) {
  // ...
}
```

#### Localisation de la documentation historique

**À mettre dans `.cursor/executed-plans/YYYY-MM-DD-description.md`** :

- Décisions de refactoring (ex: conversion en nested functions)
- Suppressions de code mort (ex: validations défensives inutiles)
- Changements architecturaux (ex: séparation modules API/client)
- Migrations de tests
- Justifications des choix techniques

**À mettre dans `.cursor/rules/summary/YYYY-MM-DD-description.md`** :

- Leçons apprises d'erreurs identifiées
- Patterns découverts et validés
- Anti-patterns identifiés
- Évolutions des règles de gouvernance

**À mettre dans les règles de gouvernance (`@*.mdc`)** :

- Principes généraux établis
- Patterns validés réutilisables
- Anti-patterns à éviter
- État d'implémentation des principes

#### Validation des commentaires dans le code

- Vérifier que les commentaires décrivent uniquement le comportement actuel du code
- Vérifier l'absence de notes historiques (Note:, supprimé, retiré, etc.)
- Vérifier que les informations historiques sont documentées dans executed-plans ou summary
- Vérifier que les principes généraux sont documentés dans les règles de gouvernance

#### État d'implémentation

✅ [Règle établie - 2025-11-12]

✅ [Application complète sur nuextract-client.js - 2025-11-12]

- 6 commentaires historiques supprimés du code source
- Documentation complète dans `.cursor/executed-plans/2025-11-12-refactoring-nested-functions-validations-defensives.md`
